<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Identificador de Relojes con IA</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; text-align: center; padding: 20px; background-color: #f0f2f5; color: #333; }
        #app-container { max-width: 700px; margin: 30px auto; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        h2 { color: #007bff; margin-bottom: 20px; }
        input[type="file"] { margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 80%; }
        button { background-color: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; transition: background-color 0.3s; }
        button:hover { background-color: #218838; }
        #resultado { margin-top: 30px; text-align: left; padding: 20px; border: 1px solid #dee2e6; border-radius: 8px; background-color: #f8f9fa; }
        .data-point { margin-bottom: 8px; line-height: 1.5; }
        .label { font-weight: bold; color: #007bff; }
        #imagen-preview { max-width: 100%; height: auto; margin-top: 15px; border-radius: 8px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <div id="app-container">
        <h2> Identificador de Relojes con IA</h2>
        <p>Sube una foto clara de tu reloj para un an谩lisis automatizado.</p>
        
        <input type="file" id="imagenReloj" accept="image/*" onchange="previewImage(event)">
        <img id="imagen-preview" src="" alt="Previsualizaci贸n de la imagen" style="display:none;">

        <button onclick="identificarReloj()">Analizar y Buscar Historia</button>
        
        <div id="resultado">
            <h3>Resultados del An谩lisis:</h3>
            <p id="status">Esperando imagen...</p>
            <div id="detalles">
                </div>
        </div>
    </div>
    
    <script>
        //  CRTICO: REEMPLAZA ESTE TEXTO CON TU CLAVE DE API REAL.
        // Tu clave es la cadena que comienza con "AIzaSy..." (de la imagen image_584f9f.png).
        const API_KEY = "PEGA_AQU_TU_CLAVE_SECRETA_DE_GOOGLE"; 
        
        function previewImage(event) {
            const reader = new FileReader();
            reader.onload = function(){
                const output = document.getElementById('imagen-preview');
                output.src = reader.result;
                output.style.display = 'block';
            };
            reader.readAsDataURL(event.target.files[0]);
        }

        function getBase64Image(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = error => reject(error);
            });
        }
        
        async function identificarReloj() {
            const fileInput = document.getElementById('imagenReloj');
            if (fileInput.files.length === 0 || API_KEY === "PEGA_AQU_TU_CLAVE_SECRETA_DE_GOOGLE") {
                document.getElementById('status').innerText = "ERROR: Selecciona una imagen y aseg煤rate de haber pegado la API Key correctamente.";
                return;
            }

            document.getElementById('status').innerText = "Analizando la imagen con la IA de Google Cloud...";
            document.getElementById('detalles').innerHTML = "";
            
            const file = fileInput.files[0];
            const base64Image = await getBase64Image(file);
            
            const requestBody = {
                requests: [{
                    image: { content: base64Image },
                    features: [{ type: "LABEL_DETECTION", maxResults: 10 }]
                }]
            };

            try {
                const response = await fetch(`https://vision.googleapis.com/v1/images:annotate?key=${API_KEY}`, {
                    method: 'POST',
                    body: JSON.stringify(requestBody),
                    headers: { 'Content-Type': 'application/json' }
                });

                const data = await response.json();
                
                if (data.responses && data.responses.length > 0 && data.responses[0].labelAnnotations) {
                    const labels = data.responses[0].labelAnnotations;
                    
                    const identificacionIA = labels.map(l => `${l.description}`).join(', ');

                    document.getElementById('status').innerText = "Identificaci贸n de la imagen completa. Buscando datos hist贸ricos (SIMULADO)...";

                    //  Esta es la secci贸n SIMULADA que te exige la creaci贸n de tu propia base de datos o APIs de pago.
                    setTimeout(() => {
                        document.getElementById('status').innerText = "Resultados listos.";
                        document.getElementById('detalles').innerHTML = `
                            <div class="data-point"><span class="label">Identificaci贸n de la IA:</span> La IA detect贸 etiquetas clave como: **${identificacionIA.substring(0, 150)}...**</div>
                            <hr style="margin: 15px 0;">
                            <h4>Datos Hist贸ricos y Precios (SIMULADOS):</h4>
                            <p>El c贸digo generado utiliza el nivel gratuito de la IA para la detecci贸n. Las funciones avanzadas de **precios en tiempo real** y **calibre** necesitan APIs de pago o tu propia base de datos (lo que genera costos o trabajo manual).</p>
                            <div class="data-point"><span class="label">Marca/Modelo Sugerido:</span> ${labels[0].description}</div>
                            <div class="data-point"><span class="label">Precio Usado (Estimado):</span> $5,000 - $20,000 USD (Seg煤n el modelo detectado)</div>
                        `;
                    }, 2500);

                } else {
                    document.getElementById('status').innerText = "Error: No se pudo identificar el reloj. Intenta con una imagen m谩s clara o revisa la API Key.";
                }

            } catch (error) {
                document.getElementById('status').innerText = `Error de Conexi贸n: ${error.message}.`;
            }
        }
    </script>
</body>
</html>